<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="Style.css">

    </head>

    <div style=" background-color: white;">
           
        <div class="navigationBar" style="background-color: white; ">
            <nav>       
              <a href="index.html" style="color: black;" >Back to Homepage</a> &nbsp; 
           </nav>
          </div>
          <h1 class="SectionHeading">Molar Mass Calculator</h1>
    
        </div>
        <body >
            <div class="ProjectsContent">
                <video class="PositionVideo"  autoplay muted loop>
                    <source src="https://user-images.githubusercontent.com/121368693/211417346-42a0b8a5-1161-4d85-a528-e25ef3e5d7c6.mp4" type="video/mp4">
                   
                  </video>
                 <br/>
                 <br/>
                 <br/>

                  <div>
                    <p1 style="font-size: large;">
                    This project has been created as a Windows Forms Application. The user can sort the periodic table elements based on their atomic number and alphabetical order using the buttons provided.
                    Entering the chemical formula in the text box displays the calculated molar mass of the element. It also checks if the input string is a valid chemical formula or not and indicates the error with red color for the label.
                   <br/>
                   <br/>
                   The functionality of the application has been accompolished using classes, dictionaries, Regular Expressions, LINQ , etc in C#.
                    
                    </p1>

                    <div style="overflow-y: scroll; height: 500px;">
                        <pre>
                            <code>
                                // Periodic table data obtained from GoodmanSciences at
                                // https://gist.github.com/GoodmanSciences/c2dd862cd38f21b0ad36b8f96b4bf1ee
                                using System;
                                using System.Collections.Generic;
                                using System.ComponentModel;
                                using System.Data;
                                using System.Drawing;
                                using System.Linq;
                                using System.Text;
                                using System.Threading.Tasks;
                                using System.Windows.Forms;
                                using System.IO;
                                using System.Text.RegularExpressions;
                                
                                namespace MMC_NoName01
                                {
                                    public partial class Form1 : Form
                                    {
                                
                                        public BindingSource _bs = new BindingSource();
                                
                                        Dictionary<string, Element> _lookupElementDict;
                                
                                        public Form1()
                                        {
                                            InitializeComponent();
                                        }
                                
                                        // On form load, immediately populate the lookup dictionary
                                        private void Form1_Load(object sender, EventArgs e)
                                        {
                                            // Use try/catch block for file IO
                                            try
                                            {
                                                // Bind data scource
                                                UI_DataGridView.DataSource = _bs;
                                
                                                // Extract periodic table data
                                                string periodicTableRaw = File.ReadAllText("../../Periodic Table of Elements.csv");
                                
                                                // Split up the rows and skip the first header row
                                                var periodTableRows = periodicTableRaw.Split(new char[] { '\r', '\n' }).Skip(1);
                                
                                                // Create lookup dictionary of elements
                                                _lookupElementDict = new Dictionary<string, Element>();
                                
                                                // Go through rows from data (each row is an element) - skip empty whitespace rows
                                                foreach (var row in from r in periodTableRows where r.Trim().Length != 0 select r)
                                                {
                                                    // Split up rows by commas because it is a CSV file
                                                    string[] columns = row.Split(',');
                                
                                                    // Get the relevant element attributes for each column
                                                    int atomicNumber = int.Parse(columns[0]);
                                                    string name = columns[1];
                                                    string symbol = columns[2];
                                                    double mass = double.Parse(columns[3]);
                                
                                                    // Populate the lookup dictionary with elements (key = symbol)
                                                    _lookupElementDict.Add(symbol, new Element(atomicNumber, name, symbol, mass));
                                                }
                                
                                                // Populate datagridview with elements from lookup dictionary using linq
                                                _bs.DataSource = from elementKVP in _lookupElementDict let element = elementKVP.Value
                                                                 select new
                                                                 {
                                                                     AtomicNumber = element.AtomicNumber,
                                                                     Name = element.ElementName,
                                                                     Symbol = element.ElementSymbol,
                                                                     Mass = element.AtomicMass
                                                                 };
                                            }
                                            catch (Exception ex)
                                            {
                                                MessageBox.Show(ex.Message);
                                            }
                                        }
                                
                                        // Regex and datagridview live update
                                        private void UI_TbxChemicalFormula_TextChanged(object sender, EventArgs e)
                                        {
                                            string _input = UI_TbxChemicalFormula.Text;
                                
                                            // Each chemical will be matched with this regex (CH4 matches C and H4)
                                            Regex _regex = new Regex("([A-Z][a-z]?)([0-9]{0,9})?");
                                            MatchCollection matches = _regex.Matches(_input);
                                            Dictionary<string, int> elementCount = new Dictionary<string, int>();
                                
                                            // Test that whole input string is a valid chemical formula
                                            Regex testRegex = new Regex("^([A-Z][a-z]?[0-9]{0,9})+$");
                                            bool validFormula = testRegex.IsMatch(_input);
                                
                                            // Use LINQ join to filter matches where the element is not a real element
                                            var validElements =
                                                from Match match in matches
                                                join Element element in _lookupElementDict.Values
                                                on match.Groups[1].Value equals element.ElementSymbol
                                                select match;
                                
                                            // All the matches were valid elements
                                            if(matches.Count.Equals(validElements.ToList().Count) && validFormula)
                                            {
                                                //if the chemical formula entered is valid, change the color of the label to green to indicate success
                                                UI_lblMolarMass.BackColor = Color.LightGreen;
                                
                                                //Iterate through each match in the valid element
                                                foreach (Match v in validElements)
                                                {
                                                    //Count of each element in the chemical formula would be atleast 1
                                                    int count = 1;
                                
                                                    //check if a number exists with the symbol, if it exists, that would be the count
                                                    if (v.Groups[2].Value.Length > 0)
                                                        count = int.Parse(v.Groups[2].Value);
                                
                                                    // Add to dictionary counting how many of each element
                                                    if (elementCount.ContainsKey(v.Groups[1].Value))
                                                        elementCount[v.Groups[1].Value] += count;
                                                    else
                                                        elementCount.Add(v.Groups[1].Value, count);
                                                }
                                
                                                // Output elements and their counts
                                                //use join to find if the key in the dictionary is found in the periodic table
                                                //This means that key==symbol in the dictionary
                                                var elementCollection = from kvp in elementCount
                                                                        join element in _lookupElementDict.Values
                                                                        on kvp.Key equals element.ElementSymbol
                                                                        select new
                                                                        {
                                                                            Element = element.ElementSymbol,
                                                                            Count = kvp.Value,
                                                                            Mass = element.AtomicMass,
                                                                            TotalMass = element.AtomicMass * kvp.Value
                                                                        };
                                                _bs.DataSource = elementCollection;
                                
                                                //calculate and display the total molar mass in the label
                                                UI_lblMolarMass.Text = elementCollection.Sum(element => element.TotalMass).ToString();
                                            }
                                            else
                                            {
                                                //The red color of the label indicates that the chemical formula is invalid.
                                                UI_lblMolarMass.BackColor = Color.Red;
                                
                                            }
                                           
                                        }
                                
                                        private void UI_BtnSortName_Click(object sender, EventArgs e)
                                        {
                                
                                            //use orderby to sort the full table by name
                                            //The chemical formula textbox clears when the sort button is pressed
                                            //The back color of the label changes to normal
                                            _bs.DataSource = from n in _lookupElementDict
                                                             let element = n.Value
                                                             select new
                                                             {
                                                                 AtomicNumber = element.AtomicNumber,
                                                                 Name = element.ElementName,
                                                                 Symbol = element.ElementSymbol,
                                                                 Mass = element.AtomicMass
                                                             } into a orderby a.Name ascending select a;
                                            UI_TbxChemicalFormula.Text = "";
                                            UI_lblMolarMass.Text = "0";
                                            UI_lblMolarMass.BackColor = Color.Empty;
                                         
                                        }
                                
                                        private void UI_BtnSortAtomicNumber_Click(object sender, EventArgs e)
                                        {
                                            //use orderby to sort the full table by atomic number
                                            //The chemical formula textbox clears when the sort button is pressed
                                            //The back color of the label changes to normal
                                            _bs.DataSource = from n in _lookupElementDict
                                                             let element = n.Value
                                                             select new
                                                             {
                                                                 AtomicNumber = element.AtomicNumber,
                                                                 Name = element.ElementName,
                                                                 Symbol = element.ElementSymbol,
                                                                 Mass = element.AtomicMass
                                                             } into a
                                                             orderby a.AtomicNumber ascending
                                                             select a;
                                
                                            UI_TbxChemicalFormula.Text = "";
                                            UI_lblMolarMass.BackColor = Color.Empty;
                                            UI_lblMolarMass.Text = "0";
                                
                                        }
                                        //single character symbold
                                        private void UI_SortSymbols_Click(object sender, EventArgs e)
                                        {
                                            //filter the full table to display only the elements with single character symbols
                                            //The chemical formula textbox clears when the button is pressed
                                            //The back color of the label changes to normal
                                            _bs.DataSource = from n in _lookupElementDict
                                                             let element = n.Value
                                                             where element.ElementSymbol.Length==1
                                                             select new
                                                             {
                                                                 AtomicNumber = element.AtomicNumber,
                                                                 Name = element.ElementName,
                                                                 Symbol = element.ElementSymbol,
                                                                 Mass = element.AtomicMass
                                                             }  into a
                                                             orderby a.Name ascending
                                                             select a;
                                            UI_TbxChemicalFormula.Text = "";
                                            UI_lblMolarMass.BackColor = Color.Empty;
                                            UI_lblMolarMass.Text = "0";
                                        }
                                    }
                                }
                                

                                </code>
                                </pre>
                                </div>
                                <br/>
                                <br/>
                                   <a href="https://github.com/Prabhjot99/MolarMassCalculator" style="text-align: center;">
                                    View Full Project on github
                                   </a>
                  </div>
                  </div>
                  </body>
                  <br/>
                  <br/>
                  <footer style="background-color: white;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16">
                        <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/>
                      </svg>
                      <div class="badge-base LI-profile-badge" data-locale="en_US" data-size="medium" data-theme="light" data-type="VERTICAL" data-vanity="prabhjotkaur99" data-version="v1"><a class="badge-base__link LI-simple-link" href="https://ca.linkedin.com/in/prabhjotkaur99?trk=profile-badge">Prabhjot Kaur</a></div>
                       
                    <span>&#9993; prabhjotkaur3934@gmail.com |</span> &nbsp;
             <span>&#9990; 780-904-3245</span><br/>
                      &copy Prabhjot Kaur 2023. All Rights Reserved
                     </footer>
</html>
